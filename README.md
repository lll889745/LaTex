# æ‰‹å†™æ•°å­¦å…¬å¼è¯†åˆ«ä¸è¯­ä¹‰ç†è§£ç³»ç»Ÿ

[![Python Version](https://img.shields.io/badge/python-3.8%2B-blue.svg)](https://www.python.org/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

ä¸€ä¸ªåŸºäºä¼ ç»Ÿå›¾åƒå¤„ç†å’Œæœºå™¨å­¦ä¹ æ–¹æ³•çš„æ‰‹å†™æ•°å­¦å…¬å¼è¯†åˆ«ç³»ç»Ÿï¼Œèƒ½å¤Ÿå°†æ‰‹å†™æ•°å­¦å…¬å¼å›¾åƒè½¬æ¢ä¸º LaTeX ä»£ç ï¼Œå¹¶è¿›è¡Œè¯­ä¹‰ç†è§£ï¼ˆå…¬å¼æ±‚è§£ã€åŒ–ç®€ç­‰ï¼‰ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ“¸ **å›¾åƒé¢„å¤„ç†**ï¼šè‡ªé€‚åº”äºŒå€¼åŒ–ã€å»å™ªã€å€¾æ–œæ ¡æ­£ã€éª¨æ¶æå–
- âœ‚ï¸ **ç¬¦å·åˆ†å‰²**ï¼šè¿é€šåŸŸåˆ†æã€ç»„ä»¶åˆå¹¶/æ‹†åˆ†ã€ç‰¹æ®Šç»“æ„å¤„ç†
- ğŸ” **ç¬¦å·è¯†åˆ«**ï¼šå¤šç‰¹å¾æå–ã€SVM/éšæœºæ£®æ—åˆ†ç±»ã€æ··æ·†æ¶ˆè§£
- ğŸŒ³ **ç»“æ„åˆ†æ**ï¼šç©ºé—´å…³ç³»åˆ¤å®šã€è¯­æ³•æ ‘æ„å»ºã€LaTeX ç”Ÿæˆ
- ğŸ§® **è¯­ä¹‰ç†è§£**ï¼šå…¬å¼ç±»å‹è¯†åˆ«ã€ç¬¦å·è®¡ç®—ã€é”™è¯¯æ£€æµ‹

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å›¾åƒé¢„å¤„ç† â”‚ â†’ â”‚  ç¬¦å·åˆ†å‰²  â”‚ â†’ â”‚  ç¬¦å·è¯†åˆ«  â”‚ â†’ â”‚  ç»“æ„åˆ†æ  â”‚ â†’ â”‚  è¯­ä¹‰ç†è§£  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“                â†“                â†“                â†“                â†“
   äºŒå€¼åŒ–          è¿é€šåŸŸåˆ†æ       ç‰¹å¾æå–        ç©ºé—´å…³ç³»åˆ¤å®š       å…¬å¼æ±‚è§£
   å»å™ª            ç»„ä»¶åˆå¹¶/æ‹†åˆ†    åˆ†ç±»è¯†åˆ«        è¯­æ³•æ ‘æ„å»º         ç¬¦å·åŒ–ç®€
   å€¾æ–œæ ¡æ­£        ç¬”ç”»åˆ†æ        æ··æ·†æ¶ˆè§£        LaTeXç”Ÿæˆ          é”™è¯¯æ£€æµ‹
```

## å®‰è£…

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- OpenCV 4.x
- NumPy, SciPy, scikit-learn
- SymPy (ç”¨äºè¯­ä¹‰ç†è§£)

### å®‰è£…æ­¥éª¤

1. å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®ï¼š

```bash
cd c:\Users\5555\Desktop\LaTex
```

2. å®‰è£…ä¾èµ–ï¼š

```bash
pip install -r requirements.txt
```

## å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ¼”ç¤º

```bash
python main.py --demo
```

### è¯†åˆ«å›¾åƒä¸­çš„å…¬å¼

```bash
python main.py --image path/to/formula.png
```

### ä½¿ç”¨ä»£ç 

```python
from src import (
    ImagePreprocessor,
    SymbolSegmenter,
    SymbolRecognizer,
    StructureAnalyzer,
    SemanticProcessor
)
import cv2

# åŠ è½½å›¾åƒ
image = cv2.imread('formula.png', cv2.IMREAD_GRAYSCALE)

# 1. å›¾åƒé¢„å¤„ç†
preprocessor = ImagePreprocessor()
binary = preprocessor.process(image)

# 2. ç¬¦å·åˆ†å‰²
segmenter = SymbolSegmenter()
symbols = segmenter.segment(binary)

# 3. ç¬¦å·è¯†åˆ«ï¼ˆéœ€è¦å…ˆè®­ç»ƒæ¨¡å‹ï¼‰
recognizer = SymbolRecognizer()
# recognizer.load_model('path/to/model.pkl')
# symbols = recognizer.recognize_symbols(symbols)

# 4. ç»“æ„åˆ†æ
analyzer = StructureAnalyzer()
syntax_tree, latex = analyzer.analyze(symbols)
print(f"LaTeX: {latex}")

# 5. è¯­ä¹‰ç†è§£
semantic = SemanticProcessor()
result = semantic.process(latex)
print(f"å…¬å¼ç±»å‹: {result.formula_type}")
print(f"è§£é‡Š: {result.interpretation}")
```

## é¡¹ç›®ç»“æ„

```
LaTex/
â”œâ”€â”€ src/                          # æºä»£ç 
â”‚   â”œâ”€â”€ __init__.py              # æ¨¡å—åˆå§‹åŒ–
â”‚   â”œâ”€â”€ config.py                # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ utils.py                 # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ preprocessing.py         # å›¾åƒé¢„å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ segmentation.py          # ç¬¦å·åˆ†å‰²æ¨¡å—
â”‚   â”œâ”€â”€ recognition.py           # ç¬¦å·è¯†åˆ«æ¨¡å—
â”‚   â”œâ”€â”€ structure_analysis.py    # ç»“æ„åˆ†ææ¨¡å—
â”‚   â””â”€â”€ semantic.py              # è¯­ä¹‰ç†è§£æ¨¡å—
â”œâ”€â”€ tests/                        # æµ‹è¯•ä»£ç 
â”‚   â””â”€â”€ test_modules.py          # å•å…ƒæµ‹è¯•
â”œâ”€â”€ examples/                     # ç¤ºä¾‹ä»£ç 
â”‚   â””â”€â”€ demo_usage.py            # ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ models/                       # æ¨¡å‹å­˜å‚¨ï¼ˆè®­ç»ƒåç”Ÿæˆï¼‰
â”œâ”€â”€ data/                         # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ training/                # è®­ç»ƒæ•°æ®
â”‚   â””â”€â”€ test/                    # æµ‹è¯•æ•°æ®
â”œâ”€â”€ main.py                       # ä¸»ç¨‹åº
â”œâ”€â”€ requirements.txt              # ä¾èµ–åˆ—è¡¨
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜
```

## æ¨¡å—è¯¦è§£

### 1. å›¾åƒé¢„å¤„ç† (preprocessing.py)

å®ç°è‡ªé€‚åº”äºŒå€¼åŒ–ï¼ˆSauvola æ–¹æ³•ï¼‰ã€å»å™ªã€å€¾æ–œæ ¡æ­£å’Œéª¨æ¶æå–ã€‚

```python
from src.preprocessing import ImagePreprocessor

preprocessor = ImagePreprocessor()

# å®Œæ•´é¢„å¤„ç†
binary = preprocessor.process(image)

# è·å–ä¸­é—´ç»“æœ
result = preprocessor.process(image, return_intermediate=True)
# result['binary']    - äºŒå€¼åŒ–ç»“æœ
# result['denoised']  - å»å™ªç»“æœ
# result['corrected'] - å€¾æ–œæ ¡æ­£ç»“æœ
# result['skeleton']  - éª¨æ¶å›¾åƒ
```

### 2. ç¬¦å·åˆ†å‰² (segmentation.py)

å°†é¢„å¤„ç†åçš„å›¾åƒåˆ†å‰²ä¸ºç‹¬ç«‹ç¬¦å·ï¼Œå¤„ç†ç²˜è¿å’Œåˆ†ç¦»çš„ç¬¦å·ã€‚

```python
from src.segmentation import SymbolSegmenter

segmenter = SymbolSegmenter()
symbols = segmenter.segment(binary)

# æå–åˆ†æ•°ç»“æ„
for sym in symbols:
    if sym.is_fraction_line:
        num, den = segmenter.extract_fraction_parts(sym, symbols)
```

### 3. ç¬¦å·è¯†åˆ« (recognition.py)

ä»ç¬¦å·å›¾åƒä¸­æå–ç‰¹å¾å¹¶è¿›è¡Œåˆ†ç±»è¯†åˆ«ã€‚

```python
from src.recognition import SymbolRecognizer, FeatureExtractor

# ç‰¹å¾æå–
extractor = FeatureExtractor()
features = extractor.extract(symbol_image)

# è®­ç»ƒåˆ†ç±»å™¨
recognizer = SymbolRecognizer()
report = recognizer.train(images, labels, classifier_type='svm')

# ä¿å­˜/åŠ è½½æ¨¡å‹
recognizer.save_model('model.pkl')
recognizer.load_model('model.pkl')

# è¯†åˆ«ç¬¦å·
label, confidence, candidates = recognizer.predict(symbol_image)
```

### 4. ç»“æ„åˆ†æ (structure_analysis.py)

åˆ†æç¬¦å·é—´çš„ç©ºé—´å…³ç³»ï¼Œæ„å»ºè¯­æ³•æ ‘ï¼Œç”Ÿæˆ LaTeX ä»£ç ã€‚

```python
from src.structure_analysis import StructureAnalyzer

analyzer = StructureAnalyzer()
syntax_tree, latex = analyzer.analyze(symbols)
```

### 5. è¯­ä¹‰ç†è§£ (semantic.py)

å¯¹è¯†åˆ«å‡ºçš„å…¬å¼è¿›è¡Œè¯­ä¹‰åˆ†æå’Œç¬¦å·è®¡ç®—ã€‚

```python
from src.semantic import SemanticProcessor

processor = SemanticProcessor()

# å®Œæ•´è¯­ä¹‰åˆ†æ
result = processor.process(latex)
print(result.formula_type)  # å…¬å¼ç±»å‹
print(result.variables)     # å˜é‡åˆ—è¡¨
print(result.solution)      # æ±‚è§£ç»“æœ

# å•ç‹¬åŠŸèƒ½
solutions = processor.solve_equation("x^2 - 4 = 0", 'x')
simplified = processor.simplify_expression(r"\frac{x^2-1}{x-1}")
derivative = processor.compute_derivative("x^3", 'x')
integral = processor.compute_integral("x^2", 'x')
```

## æ”¯æŒçš„ç¬¦å·

- **æ•°å­—**ï¼š0-9
- **æ‹‰ä¸å­—æ¯**ï¼ša-z, A-Z
- **å¸Œè…Šå­—æ¯**ï¼šÎ±, Î², Î³, Î´, Î¸, Î», Î¼, Ï€, Ïƒ, Ï†, Ï‰ ç­‰
- **è¿ç®—ç¬¦**ï¼š+, -, Ã—, Ã·, =, â‰ , <, >, â‰¤, â‰¥, Â±
- **ç‰¹æ®Šç¬¦å·**ï¼šâˆš, âˆ‘, âˆ, âˆ«, âˆ, âˆ‚, âˆ‡
- **æ‹¬å·**ï¼š(), [], {}

## è¿è¡Œæµ‹è¯•

```bash
cd tests
python -m pytest test_modules.py -v
```

## è¿è¡Œç¤ºä¾‹

```bash
cd examples
python demo_usage.py
```

## é…ç½®è¯´æ˜

åœ¨ `src/config.py` ä¸­å¯ä»¥è°ƒæ•´å„æ¨¡å—çš„å‚æ•°ï¼š

```python
from src.config import SystemConfig, PreprocessingConfig

# è‡ªå®šä¹‰é…ç½®
config = SystemConfig()
config.preprocessing.sauvola_window_size = 31
config.preprocessing.sauvola_k = 0.3
config.recognition.svm_c = 100.0
```

## æ³¨æ„äº‹é¡¹

1. **ç¬¦å·è¯†åˆ«éœ€è¦è®­ç»ƒ**ï¼šé¦–æ¬¡ä½¿ç”¨éœ€è¦å‡†å¤‡è®­ç»ƒæ•°æ®å¹¶è®­ç»ƒåˆ†ç±»å™¨
2. **æ•°æ®é›†æ¨è**ï¼šå¯ä½¿ç”¨ CROHME æˆ– HASYv2 æ•°æ®é›†è¿›è¡Œè®­ç»ƒ
3. **SymPy ä¾èµ–**ï¼šè¯­ä¹‰ç†è§£åŠŸèƒ½éœ€è¦å®‰è£… SymPy åº“

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„ç¬¦å·ç±»åˆ«

1. åœ¨ `config.py` çš„ `SYMBOL_TO_LATEX` ä¸­æ·»åŠ æ˜ å°„
2. å‡†å¤‡å¯¹åº”çš„è®­ç»ƒæ ·æœ¬
3. é‡æ–°è®­ç»ƒè¯†åˆ«æ¨¡å‹

### è‡ªå®šä¹‰é¢„å¤„ç†æµç¨‹

```python
class CustomPreprocessor(ImagePreprocessor):
    def process(self, image, return_intermediate=False):
        # è‡ªå®šä¹‰é¢„å¤„ç†é€»è¾‘
        gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
        binary = self.custom_binarization(gray)
        return binary
```

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è®¸å¯è¯

MIT License

## å‚è€ƒèµ„æ–™

- [CROHME æ•°æ®é›†](https://www.isical.ac.in/~crohme/)
- [HASYv2 æ•°æ®é›†](https://zenodo.org/record/259444)
- [SymPy æ–‡æ¡£](https://docs.sympy.org/)
- [OpenCV æ–‡æ¡£](https://docs.opencv.org/)
